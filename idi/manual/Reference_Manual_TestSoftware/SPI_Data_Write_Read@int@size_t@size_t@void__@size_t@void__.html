<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN">
<html>
<head>
<title>SPI_Data_Write_Read Function</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoadEx(&#39;frames.html&#39;, &#39;topic&#39;, &#39;SPI_Data_Write_Read@int@size_t@size_t@void__@size_t@void__.html&#39;);" onmousedown="onBodyMouseDown();">

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<em>You are here:</em> <a href="C_Test_Code_-_DOS.html" target="topic">C Test Code - DOS</a> &gt; Symbol Reference &gt; <a href="!!FUNCTIONS.html" target="topic">Functions</a> &gt; <a href="SPI_Data_Write_Read@int@size_t@size_t@void__@size_t@void__.html" target="topic">SPI_Data_Write_Read Function</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="33%">
<div class="Element1">
STD-Bus Test Software Reference Manual</div>
</td><td width="34%">
<div class="Element2">
<a href="contents.html" target="tocidx"><img src="btn_globals_contents_darkblue.gif" border="0" alt="Contents" title="Contents" onmouseover="switchImage(this, &#39;btn_globals_contents_darkblue_hover.gif&#39;);" onmouseout="switchImage(this, &#39;btn_globals_contents_darkblue.gif&#39;);" /></a><a href="idx.html" target="tocidx"><img src="btn_globals_index_darkblue.gif" border="0" alt="Index" title="Index" onmouseover="switchImage(this, &#39;btn_globals_index_darkblue_hover.gif&#39;);" onmouseout="switchImage(this, &#39;btn_globals_index_darkblue.gif&#39;);" /></a><a href="index.html" target="topic"><img src="btn_globals_home_darkblue.gif" border="0" alt="Home" title="Home" onmouseover="switchImage(this, &#39;btn_globals_home_darkblue_hover.gif&#39;);" onmouseout="switchImage(this, &#39;btn_globals_home_darkblue.gif&#39;);" /></a></div>
</td><td width="33%">
<div class="Element90">
<a href="SPI_Data_Write@int@void__@size_t@size_t@FILE__.html" target="topic"><img src="btn_prev_midblue.gif" border="0" alt="Previous" title="Previous" onmouseover="switchImage(this, &#39;btn_prev_midblue_hover.gif&#39;);" onmouseout="switchImage(this, &#39;btn_prev_midblue.gif&#39;);" /></a><a href="!!FUNCTIONS.html" target="topic"><img src="btn_up_midblue.gif" border="0" alt="Up" title="Up" onmouseover="switchImage(this, &#39;btn_up_midblue_hover.gif&#39;);" onmouseout="switchImage(this, &#39;btn_up_midblue.gif&#39;);" /></a><a href="SPI_Data_Write_Read_Helper_Commit@int@size_t@SPI_CSB_ENUM@BOOL@BOOL__.html" target="topic"><img src="btn_next_midblue.gif" border="0" alt="Next" title="Next" onmouseover="switchImage(this, &#39;btn_next_midblue_hover.gif&#39;);" onmouseout="switchImage(this, &#39;btn_next_midblue.gif&#39;);" /></a></div>
</td></tr></table><div class="Element5">
SPI_Data_Write_Read Function</div>
<div class="Element7">
<a href="idi_c.html" target="topic">idi.c</a> | <a href="!!FUNCTIONS.html" target="topic">Functions</a> | <a href="!!NAVID_SPI_Data_Write_Read@int@size_t@size_t@void__@size_t@void___ST(16)_SEC_Body_Source.html" target="topic">Body Source</a></div>
<div class="Element731">
<div class="Element730">
<a onclick="ToggleAllElements(&#39;46696C65,506172616D6574657273,52657475726E73,4465736372697074696F6E,426F647920536F75726365,47726F7570,4C696E6B73&#39;, &#39;linkToggleAllElements&#39;, &#39;imgToggleAllElements&#39;, &#39;Collapse All&#39;, &#39;Expand All&#39;);"><img src="btn_collapse.gif" border="0" alt="" title="" id="imgToggleAllElements" /></a><a id="linkToggleAllElements" onclick="ToggleAllElements(&#39;46696C65,506172616D6574657273,52657475726E73,4465736372697074696F6E,426F647920536F75726365,47726F7570,4C696E6B73&#39;, &#39;linkToggleAllElements&#39;, &#39;imgToggleAllElements&#39;, &#39;Collapse All&#39;, &#39;Expand All&#39;);">Collapse All</a></div>
</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<a name="PageContent"></a><div class="Element58">
<a name="432B2B"></a><div class="Element99">
C++</div>
<div class="Element101"><div class="Element100"><pre class="Element100"><strong><span style="color: #008000;">int</span></strong> <strong><span style="color: #660000;">SPI_Data_Write_Read</span></strong>(<strong><span style="color: #008000;">int</span></strong> <strong><span style="color: #800080;">board_id</span></strong>, size_t <strong><span style="color: #800080;">object_size</span></strong>, size_t <strong><span style="color: #800080;">tx_object_count</span></strong>, <strong><span style="color: #008000;">const</span></strong> <strong><span style="color: #008000;">void</span></strong> * <strong><span style="color: #800080;">tx_buffer</span></strong>, size_t <strong><span style="color: #800080;">rx_object_count</span></strong>, <strong><span style="color: #008000;">const</span></strong> <strong><span style="color: #008000;">void</span></strong> * <strong><span style="color: #800080;">rx_buffer</span></strong>);</pre></div></div>
<a name="46696C65"></a><div class="Element14">
<a onclick="toggleVisibilityStored(&#39;46696C65&#39;);" class="a_Element14"><img src="btn_collapse_large.gif" border="0" alt="" title="" id="img46696C65" />File</a></div>
<div id="div46696C65">
<div class="Element11">
<div class="Element10">
<p class="Element10">
<a href="idi_c.html" target="topic">idi.c</a></p></div>
</div>
</div>
<a name="506172616D6574657273"></a><div class="Element14">
<a onclick="toggleVisibilityStored(&#39;506172616D6574657273&#39;);" class="a_Element14"><img src="btn_collapse_large.gif" border="0" alt="" title="" id="img506172616D6574657273" />Parameters</a></div>
<div id="div506172616D6574657273">
<div class="Element11">
<div class="Element10">
<div class="Element252">
<div class="TableDiv">
<table cellspacing="0" class="Table3">
<tr>
<td class="Element240" valign="top" width="50%">
<div class="Element241">
Parameters&#160;</div></td><td class="Element244" valign="top" width="50%">
<div class="Element245">
Description&#160;</div></td></tr><tr>
<td class="Element242" valign="top" width="50%">
<div class="Element243">
size_t object_size&#160;</div></td><td class="Element246" valign="top" width="50%">
<div class="Element247">
*&lt; TX &amp; RX object size: 1 &lt;= object_size &lt;= FIFO_SIZE&#160;</div></td></tr><tr>
<td class="Element242" valign="top" width="50%">
<div class="Element243">
size_t tx_object_count&#160;</div></td><td class="Element246" valign="top" width="50%">
<div class="Element247">
*&lt; object count&#160;</div></td></tr><tr>
<td class="Element242" valign="top" width="50%">
<div class="Element243">
size_t rx_object_count&#160;</div></td><td class="Element246" valign="top" width="50%">
<div class="Element247">
*&lt; object count&#160;</div></td></tr></table></div></div>
</div>
</div>
</div>
<a name="52657475726E73"></a><div class="Element14">
<a onclick="toggleVisibilityStored(&#39;52657475726E73&#39;);" class="a_Element14"><img src="btn_collapse_large.gif" border="0" alt="" title="" id="img52657475726E73" />Returns</a></div>
<div id="div52657475726E73">
<div class="Element11">
<div class="Element10">
<p class="Element10">
A zero (SUCCESS) is returned if successful, otherwise a negative error code is returned.</p></div>
</div>
</div>
<a name="4465736372697074696F6E"></a><div class="Element14">
<a onclick="toggleVisibilityStored(&#39;4465736372697074696F6E&#39;);" class="a_Element14"><img src="btn_collapse_large.gif" border="0" alt="" title="" id="img4465736372697074696F6E" />Description</a></div>
<div id="div4465736372697074696F6E">
<div class="Element11">
<div class="Element10">
<p class="Element10">
brief&#160;</p>
<p class="Element10">
If CSB = software. Stuff as fast as you can.&#160;</p>
<p class="Element10">
If CSB == buffer. if object size = 1, then stuff as fast as you can. The chip select will go active and only go inactive when done transmitting. This is best used for objects whos size is less than SPI_FIFO_SIZE. if object size != 1, then stuff only that quantity and wait until buffers are empty in order to have the chip select wrap around the data.&#160;</p>
<p class="Element10">
If CSB == <a href="uint8_t.html" target="topic">uint8_t</a> Stuff as fast as you can.&#160;</p>
<p class="Element10">
If CSB == <a href="uint16_t.html" target="topic">uint16_t</a> Stuff two bytes at a time as fast as you can. The object_size must be set to 2 for this to work.&#160;</p>
<p class="Element10">
&#160;</p></div>
</div>
</div>
<a name="426F647920536F75726365"></a><div class="Element14">
<a onclick="toggleVisibilityStored(&#39;426F647920536F75726365&#39;);" class="a_Element14"><img src="btn_collapse_large.gif" border="0" alt="" title="" id="img426F647920536F75726365" />Body Source</a></div>
<div id="div426F647920536F75726365">
<div class="Element11">
<div class="Element10">
<div class="Element170">
<a href="#" onclick="CopyElementToClipboard(&#39;code00240&#39;);">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code00240"><pre class="Element12">  1: <strong><span style="color: #008000;">int</span></strong> SPI_Data_Write_Read( 	<strong><span style="color: #008000;">int</span></strong> 		 board_id,
  2: 							size_t		 object_size,  		
  3: 							size_t		 tx_object_count, 	
  4: 							<strong><span style="color: #008000;">const</span></strong> <strong><span style="color: #008000;">void</span></strong> * tx_buffer,
  5: 							size_t		 rx_object_count,  	
  6: 							<strong><span style="color: #008000;">const</span></strong> <strong><span style="color: #008000;">void</span></strong> * rx_buffer
  7: 						)
  8: {
  9: 	<strong><span style="color: #008000;">int</span></strong>				error_code;
 10: 	<a href="SPI_CSB_ENUM.html" target="topic">SPI_CSB_ENUM</a>	csb;
 11: 	size_t			rx_bytes_available;
 12: 	<a href="BOOL.html" target="topic">BOOL</a>			rx_empty;
 13: 	size_t			tx_bytes_available;
 14: 	<a href="BOOL.html" target="topic">BOOL</a>			active_tx;
 15: 	<a href="BOOL.html" target="topic">BOOL</a>			active_rx;
 16: 	<a href="BOOL.html" target="topic">BOOL</a>			tx_empty;
 17: 	<a href="BOOL.html" target="topic">BOOL</a>			tx_full;
 18: 	size_t 			index_tx;			
 19: 	size_t 			index_rx;
 20: 
 21: 
 22: 
 23: 
 24: 
 25: 	<a href="BOOL.html" target="topic">BOOL</a> 			commit_valid;
 26: 	<a href="BOOL.html" target="topic">BOOL</a>			commit_ready;
 27: 	<a href="uint8_t.html" target="topic">uint8_t</a> 		bit_bucket; 
 28: 
 29: 
 30: <strong><span style="color: #008000;">#if</span></strong> defined( SPI_PRINT_DEBUG )
 31: <strong><span style="color: #008000;">#if</span></strong> defined( __MSDOS__ )
 32: 	<strong><span style="color: #008000;">static</span></strong> size_t   internal_count = 0;
 33: <strong><span style="color: #008000;">#endif</span></strong>
 34: <strong><span style="color: #008000;">#endif</span></strong>
 35: 
 36: 	<strong><span style="color: #008000;">struct</span></strong> <a href="board_dataset.html" target="topic">board_dataset</a> *  dataset    = ( <strong><span style="color: #008000;">struct</span></strong> <a href="board_dataset.html" target="topic">board_dataset</a> * )  <a href="board_definition.html" target="topic">board_definition</a>[board_id].dataset;
 37: 
 38: <strong><span style="color: #008000;">#define</span></strong> FUNCTION_NAME__  &quot;SPI_Data_Write_Read&quot;
 39: <strong><span style="color: #008000;">#if</span></strong> ( <a href="IO_TRACE_USE_SPI_LOGGING.html" target="topic">IO_TRACE_USE_SPI_LOGGING</a> == 1 )
 40: 	<a href="IO_Trace_Log_Function@char__@size_t@enum_IO_TRACE_ENUM@int@int.html" target="topic">IO_Trace_Log_Function</a>( FUNCTION_NAME__, __LINE__, IO_TRACE_SPI, board_id, 0 );
 41: <strong><span style="color: #008000;">#endif</span></strong>
 42: <strong><span style="color: #008000;">#undef</span></strong> FUNCTION_NAME__
 43: 
 44: 
 45: <strong><span style="color: #008000;">#if</span></strong> defined( SPI_PRINT_DEBUG )
 46: 	printf( &quot;*** SPI_Data_Write_Read:  Entry.\n&quot; );
 47: <strong><span style="color: #008000;">#endif</span></strong>
 48: <strong><span style="color: #008000;">#if</span></strong> defined( SPI_PRINT_XFR_DEBUG )
 49: 	printf( &quot;*** SPI_Data_Write_Read:  Entry.\n&quot; );
 50: <strong><span style="color: #008000;">#endif</span></strong>
 51: 
 52: 	index_tx = 0;
 53: 	index_rx = 0;
 54: 
 55: 
 56: 
 57: 	
 58: 	<strong><span style="color: #008000;">if</span></strong> ( ( NULL == tx_buffer ) &amp;&amp; ( NULL == rx_buffer ) )
 59: 	{ 
 60: 		error_code = SUCCESS;
 61: 		<strong><span style="color: #008000;">goto</span></strong> SPI_Data_Write_Read_Error_Exit;
 62: 	}
 63: 	<strong><span style="color: #008000;">if</span></strong> ( <a href="SPI_IsNotPresent@int.html" target="topic">SPI_IsNotPresent</a>( board_id ) )
 64: 	{ 
 65: 		error_code = -EC_SPI_NOT_FOUND;
 66: 		<strong><span style="color: #008000;">goto</span></strong> SPI_Data_Write_Read_Error_Exit;
 67: 	}
 68: 
 69: 	
 70: 	<strong><span style="color: #008000;">if</span></strong> ( ( NULL != tx_buffer ) &amp;&amp; ( NULL != rx_buffer ) )
 71: 	{ 
 72: 		<strong><span style="color: #008000;">if</span></strong> ( tx_object_count != rx_object_count )
 73: 		{ 
 74: 			error_code = -EC_SPI_BUFFER_MISMATCH;
 75: 			<strong><span style="color: #008000;">goto</span></strong> SPI_Data_Write_Read_Error_Exit;
 76: 		}
 77: 	}
 78: 	<strong><span style="color: #008000;">if</span></strong> ( NULL != tx_buffer )
 79: 	{ 
 80: 		active_tx = <strong><span style="color: #008000;">true</span></strong>;
 81: 	}
 82: 	<strong><span style="color: #008000;">else</span></strong>
 83: 	{ 
 84: 		tx_object_count = rx_object_count;
 85: 		active_tx       = <strong><span style="color: #008000;">false</span></strong>; 
 86: 	}
 87: 	<strong><span style="color: #008000;">if</span></strong> ( NULL != rx_buffer )
 88: 	{ 
 89: 		active_rx        = <strong><span style="color: #008000;">true</span></strong>;
 90: 	}
 91: 	<strong><span style="color: #008000;">else</span></strong>
 92: 	{ 
 93: 		rx_object_count = tx_object_count;
 94: 		active_rx       = <strong><span style="color: #008000;">false</span></strong>; 
 95: 	}
 96: 
 97: 	
 98: 	<a href="SPI_Configuration_Chip_Select_Behavior_Get@int@SPI_CSB_ENUM__.html" target="topic">SPI_Configuration_Chip_Select_Behavior_Get</a>( board_id, &amp;csb );
 99: 
100: 	<strong><span style="color: #008000;">if</span></strong> ( CSB_SOFTWARE == csb )
101: 	{ 
102: 		<a href="uint8_t.html" target="topic">uint8_t</a> chip_select;
103: 		<strong><span style="color: #008000;">if</span></strong> ( 0 == <a href="SPI_Commit_Get@int@uint8_t__.html" target="topic">SPI_Commit_Get</a>( board_id, &amp;chip_select ) )
104: 		{ 
105: <strong><span style="color: #008000;">#if</span></strong> defined( SPI_PRINT_DEBUG )
106: 			printf( &quot;SPI_Data_Write_Read: Warning Chip select not active, setting it now\n&quot; );
107: <strong><span style="color: #008000;">#endif</span></strong>
108: 			<a href="SPI_Commit@int@uint8_t.html" target="topic">SPI_Commit</a>( board_id, 0xFF );
109: 		}
110: 	}
111: 
112: 	<strong><span style="color: #008000;">if</span></strong> ( CSB_uint16_t == csb )
113: 	{ 
114: 		<strong><span style="color: #008000;">if</span></strong> ( object_size &amp; 0x01 )
115: 		{ 
116: 			printf( &quot;SPI_Data_Write_Read: Object Size is set to &quot; );
117: <strong><span style="color: #008000;">#if</span></strong> defined( __MSDOS__ )
118: 			printf( &quot;%d&quot;, object_size );
119: <strong><span style="color: #008000;">#else</span></strong>
120: 			printf( &quot;%lu&quot;, object_size );
121: <strong><span style="color: #008000;">#endif</span></strong>
122: 			printf( &quot;, and ought to be set to 2\n&quot; );
123: 			error_code = -EC_SPI_BUFFER_SIZE_ODD;
124: 			<strong><span style="color: #008000;">goto</span></strong> SPI_Data_Write_Read_Error_Exit;
125: 		}
126: 	}
127: 
128: <strong><span style="color: #008000;">#if</span></strong> defined( SPI_PRINT_DEBUG )
129: 	printf( &quot;SPI_Data_Write_Read:\n&quot; );
130: 	<strong><span style="color: #008000;">#if</span></strong> defined( __MSDOS__ )
131: 	printf( &quot;  object_size       = %d\n&quot;, object_size );
132: 	printf( &quot;  tx_object_count   = %d\n&quot;, tx_object_count );
133: 	printf( &quot;  rx_object_count   = %d\n&quot;, rx_object_count );
134: 	printf( &quot;  index_tx          = %d\n&quot;, index_tx );
135: 	printf( &quot;  index_rx          = %d\n&quot;, index_rx );
136: 	printf( &quot;  tx_buffer         = %p\n&quot;, tx_buffer );
137: 	printf( &quot;  rx_buffer         = %p\n&quot;, rx_buffer );
138: 	<strong><span style="color: #008000;">#else</span></strong>
139: 	printf( &quot;  object_size       = %lu\n&quot;, object_size );
140: 	printf( &quot;  tx_object_count   = %lu\n&quot;, tx_object_count );
141: 	printf( &quot;  rx_object_count   = %lu\n&quot;, rx_object_count );
142: 	printf( &quot;  index_tx          = %lu\n&quot;, index_tx );
143: 	printf( &quot;  index_rx          = %lu\n&quot;, index_rx );
144: 	printf( &quot;  tx_buffer         = %p\n&quot;, tx_buffer );
145: 	printf( &quot;  rx_buffer         = %p\n&quot;, rx_buffer );
146: 	<strong><span style="color: #008000;">#endif</span></strong>
147: 	printf( &quot;  active_tx         = %s\n&quot;, active_tx ? &quot;true&quot; : &quot;false&quot; );
148: 	printf( &quot;  active_rx         = %s\n&quot;, active_rx ? &quot;true&quot; : &quot;false&quot; );
149: 
150: 	<strong><span style="color: #008000;">if</span></strong> ( NULL != tx_buffer )
151: 	{ 
152: 		size_t count = object_size * tx_object_count;
153: 		<strong><span style="color: #008000;">if</span></strong> ( count &gt; HEX_DUMP_BYTES_PER_LINE ) count = HEX_DUMP_BYTES_PER_LINE;
154: 		<a href="Hex_Dump_Line@uint16_t@size_t@uint8_t__@FILE__.html" target="topic">Hex_Dump_Line</a>( 0, count, (<a href="uint8_t.html" target="topic">uint8_t</a> *) tx_buffer, stdout );
155: 	}
156: <strong><span style="color: #008000;">#endif</span></strong>
157: 
158: 
159: 	<strong><span style="color: #008000;">if</span></strong> ( CSB_BUFFER == csb )
160: 	{ 
163: 		<strong><span style="color: #008000;">if</span></strong> ( object_size &gt; SPI_FIFO_SIZE )
164: 		{
165: 			error_code = -EC_SPI_OBJECT_SIZE;
166: 			<strong><span style="color: #008000;">goto</span></strong> SPI_Data_Write_Read_Error_Exit;
167: 		}
168: 	}
169: 
170: 
171: 	
172: 	
173: 	<a href="SPI_Status_Write_FIFO_Status@int@BOOL__@BOOL__@size_t__.html" target="topic">SPI_Status_Write_FIFO_Status</a>( board_id, &amp;tx_full, &amp;tx_empty, &amp;tx_bytes_available );
174: 	<strong><span style="color: #008000;">if</span></strong> ( ( <strong><span style="color: #008000;">false</span></strong> == tx_empty ) &amp;&amp; ( CSB_SOFTWARE != csb ) ) <a href="SPI_Commit@int@uint8_t.html" target="topic">SPI_Commit</a>( board_id, 0xFF );
175: 	<strong><span style="color: #008000;">do</span></strong>
176: 	{ 
177: 		error_code = SUCCESS;
178: 		<strong><span style="color: #008000;">if</span></strong> ( dataset-&gt;quit_application ) error_code = -EC_APP_TERMINATE_CTRLC;
179: 		<strong><span style="color: #008000;">if</span></strong> ( <a href="Character_Get@int__.html" target="topic">Character_Get</a>( NULL )     ) error_code = -EC_APP_TERMINATE;
180: 		<strong><span style="color: #008000;">if</span></strong> ( SUCCESS != error_code     )
181: 		{
182: 			printf( &quot;SPI_Data_Write_Read initial empty tx\n&quot; );
183: 			<strong><span style="color: #008000;">goto</span></strong> SPI_Data_Write_Read_Error_Exit;
184: 		}
185: 		<a href="SPI_Status_Write_FIFO_Status@int@BOOL__@BOOL__@size_t__.html" target="topic">SPI_Status_Write_FIFO_Status</a>( board_id, &amp;tx_full, &amp;tx_empty, &amp;tx_bytes_available );
186: 	} <strong><span style="color: #008000;">while</span></strong> ( <strong><span style="color: #008000;">false</span></strong> == tx_empty );
187: 
188: 	
189: 	<strong><span style="color: #008000;">do</span></strong>
190: 	{ 
191: 		error_code = SUCCESS;
192: 		<strong><span style="color: #008000;">if</span></strong> ( dataset-&gt;quit_application ) error_code = -EC_APP_TERMINATE_CTRLC;
193: 		<strong><span style="color: #008000;">if</span></strong> ( <a href="Character_Get@int__.html" target="topic">Character_Get</a>( NULL )     ) error_code = -EC_APP_TERMINATE;
194: 		<strong><span style="color: #008000;">if</span></strong> ( SUCCESS != error_code     )
195: 		{
196: 			printf( &quot;SPI_Data_Write_Read initial empty rx\n&quot; );
197: 			<strong><span style="color: #008000;">goto</span></strong> SPI_Data_Write_Read_Error_Exit;
198: 		}
199: 		<a href="SPI_Status_Read_FIFO_Status@int@BOOL__@size_t__.html" target="topic">SPI_Status_Read_FIFO_Status</a>( board_id, &amp;rx_empty, &amp;rx_bytes_available );
200: 		<strong><span style="color: #008000;">if</span></strong> ( <strong><span style="color: #008000;">false</span></strong> == rx_empty )
201: 		{
202: 			<strong><span style="color: #008000;">switch</span></strong> ( board_id )
203: 			{
204: 				<strong><span style="color: #008000;">case</span></strong> ID_IDI48:	<a href="IO_Read_U8@int@size_t@int@uint8_t__.html" target="topic">IO_Read_U8</a>( board_id, __LINE__, IDI_SPI_DATA, &amp;bit_bucket  ); 	<strong><span style="color: #008000;">break</span></strong>;
205: 				<strong><span style="color: #008000;">case</span></strong> ID_IDO48:	<a href="IO_Read_U8@int@size_t@int@uint8_t__.html" target="topic">IO_Read_U8</a>( board_id, __LINE__, IDO_SPI_DATA, &amp;bit_bucket  ); 	<strong><span style="color: #008000;">break</span></strong>;
206: 			}
207: 		}
208: 	} <strong><span style="color: #008000;">while</span></strong> ( <strong><span style="color: #008000;">false</span></strong> == rx_empty );
209: 
210: 	index_tx     = 0;
211: 	index_rx     = 0;
212: 	commit_valid = <strong><span style="color: #008000;">false</span></strong>;
213: 	commit_ready = <strong><span style="color: #008000;">false</span></strong>;
214: 	<strong><span style="color: #008000;">while</span></strong> ( index_tx &lt; tx_object_count )
215: 	{
216: 		error_code = SUCCESS;
217: 		<strong><span style="color: #008000;">if</span></strong> ( dataset-&gt;quit_application ) error_code = -EC_APP_TERMINATE_CTRLC;
218: 		<strong><span style="color: #008000;">if</span></strong> ( <a href="Character_Get@int__.html" target="topic">Character_Get</a>( NULL )     ) error_code = -EC_APP_TERMINATE;
219: 		<strong><span style="color: #008000;">if</span></strong> ( SUCCESS != error_code     )
220: 		{
221: 			printf( &quot;SPI_Data_Write_Read main loop\n&quot; );
222: 			<strong><span style="color: #008000;">goto</span></strong> SPI_Data_Write_Read_Error_Exit;
223: 		}
224: 
225: <strong><span style="color: #008000;">#if</span></strong> defined( SPI_PRINT_XFR_DEBUG )
226: <strong><span style="color: #008000;"># if</span></strong> defined( __MSDOS__ )
227: 		delay( 250  );  
228: 		
229: 		<a href="SPI_Data_Write_Read_Helper_Read@int@size_t@size_t@BOOL@size_t__@void__.html" target="topic">SPI_Data_Write_Read_Helper_Read</a>( board_id, object_size, tx_object_count, active_rx, &amp;index_rx, rx_buffer );
230: 		delay( 250   );
231: <strong><span style="color: #008000;"># endif</span></strong>
232: <strong><span style="color: #008000;">#endif</span></strong>
233: 
234: <strong><span style="color: #008000;">#if</span></strong> defined( SPI_PRINT_DEBUG )
235: <strong><span style="color: #008000;"># if</span></strong> defined( __MSDOS__ )
236: 		internal_count++;
237: 		printf( &quot;SPI_Data_Write_Read:  LOOP: internal_count = %u\n&quot;, internal_count );
238: 		printf( &quot;  object_size       = %d\n&quot;, object_size );
239: 		printf( &quot;  tx_object_count   = %d\n&quot;, tx_object_count );
240: 		printf( &quot;  rx_object_count   = %d\n&quot;, rx_object_count );
241: 		printf( &quot;  index_tx          = %d\n&quot;, index_tx );
242: 		printf( &quot;  index_rx          = %d\n&quot;, index_rx );
243: 		printf( &quot;  tx_buffer         = %p\n&quot;, tx_buffer );
244: 		printf( &quot;  rx_buffer         = %p\n&quot;, rx_buffer );
245: 		delay( 1000  );
246: <strong><span style="color: #008000;"># endif</span></strong>
247: <strong><span style="color: #008000;">#endif</span></strong>
248: 
249: 		
252: 		<a href="SPI_Data_Write_Read_Helper_Read@int@size_t@size_t@BOOL@size_t__@void__.html" target="topic">SPI_Data_Write_Read_Helper_Read</a>( board_id, object_size, tx_object_count, active_rx, &amp;index_rx, rx_buffer );
253: 
254: 
255: <strong><span style="color: #008000;">#if</span></strong> defined( SPI_PRINT_DEBUG )
256: <strong><span style="color: #008000;"># if</span></strong> defined( __MSDOS__ )
257: 		<strong><span style="color: #008000;">if</span></strong> ( index_rx != index_tx )
258: 		{
259: 			error_code = -EC_SPI_BUFFER_MISMATCH;
260: 			printf( &quot;SPI_Data_Write_Read:  MISMATCH: internal_count = %u\n&quot;, internal_count );
261: 
262: 			<strong><span style="color: #008000;">#if</span></strong> defined( __MSDOS__ )
263: 			printf( &quot;  object_size       = %d\n&quot;, object_size );
264: 			printf( &quot;  tx_object_count   = %d\n&quot;, tx_object_count );
265: 			printf( &quot;  rx_object_count   = %d\n&quot;, rx_object_count );
266: 			printf( &quot;  index_tx          = %d\n&quot;, index_tx );
267: 			printf( &quot;  index_rx          = %d\n&quot;, index_rx );
268: 			printf( &quot;  tx_buffer         = %p\n&quot;, tx_buffer );
269: 			printf( &quot;  rx_buffer         = %p\n&quot;, rx_buffer );
270: 			<strong><span style="color: #008000;">#else</span></strong>
271: 			printf( &quot;  object_size       = %lu\n&quot;, object_size );
272: 			printf( &quot;  tx_object_count   = %lu\n&quot;, tx_object_count );
273: 			printf( &quot;  rx_object_count   = %lu\n&quot;, rx_object_count );
274: 			printf( &quot;  index_tx          = %lu\n&quot;, index_tx );
275: 			printf( &quot;  index_rx          = %lu\n&quot;, index_rx );
276: 			printf( &quot;  tx_buffer         = %p\n&quot;, tx_buffer );
277: 			printf( &quot;  rx_buffer         = %p\n&quot;, rx_buffer );
278: 			<strong><span style="color: #008000;">#endif</span></strong>
279: 			printf( &quot;  active_tx         = %s\n&quot;, active_tx ? &quot;true&quot; : &quot;false&quot; );
280: 			printf( &quot;  active_rx         = %s\n&quot;, active_rx ? &quot;true&quot; : &quot;false&quot; );
281: 
282: 			<strong><span style="color: #008000;">goto</span></strong> SPI_Data_Write_Read_Error_Exit;
283: 		}
284: <strong><span style="color: #008000;"># endif</span></strong>
285: <strong><span style="color: #008000;">#endif</span></strong>
286: 
287: 		
288: 		<a href="SPI_Data_Write_Read_Helper_Commit@int@size_t@SPI_CSB_ENUM@BOOL@BOOL__.html" target="topic">SPI_Data_Write_Read_Helper_Commit</a>( board_id, object_size, csb, commit_ready, &amp;commit_valid );
289: 
290: 		
293: 		<a href="SPI_Data_Write_Read_Helper_Write@int@size_t@size_t@SPI_CSB_ENUM@BOOL@BOOL@BOOL__@size_t__@void__.html" target="topic">SPI_Data_Write_Read_Helper_Write</a>( 	board_id,
294: 											object_size,
295: 											tx_object_count,
296: 											csb,
297: 											active_tx,
298: 											commit_valid,
299: 											&amp;commit_ready,
300: 											&amp;index_tx,
301: 											tx_buffer
302: 										);
303: 
304: 
305: 
306: 		
307: 		<a href="SPI_Data_Write_Read_Helper_Commit@int@size_t@SPI_CSB_ENUM@BOOL@BOOL__.html" target="topic">SPI_Data_Write_Read_Helper_Commit</a>( board_id, object_size, csb, commit_ready, &amp;commit_valid );
308: 
309: 	}
310: <strong><span style="color: #008000;">#if</span></strong> defined( SPI_PRINT_DEBUG )
311: printf( &quot;  SPI_Data_Write_Read: Post write operations\n&quot; );
312: <strong><span style="color: #008000;">#endif</span></strong>
313: 
314: 	
315: 	<strong><span style="color: #008000;">do</span></strong>
316: 	{
317: 		error_code = SUCCESS;
318: 		<strong><span style="color: #008000;">if</span></strong> ( dataset-&gt;quit_application ) error_code = -EC_APP_TERMINATE_CTRLC;
319: 		<strong><span style="color: #008000;">if</span></strong> ( <a href="Character_Get@int__.html" target="topic">Character_Get</a>( NULL )     ) error_code = -EC_APP_TERMINATE;
320: 		<strong><span style="color: #008000;">if</span></strong> ( SUCCESS != error_code     )
321: 		{
322: 			printf( &quot;SPI_Data_Write_Read status ending portion\n&quot; );
323: 			<strong><span style="color: #008000;">goto</span></strong> SPI_Data_Write_Read_Error_Exit;
324: 		}
325: 		<a href="SPI_Data_Write_Read_Helper_Commit@int@size_t@SPI_CSB_ENUM@BOOL@BOOL__.html" target="topic">SPI_Data_Write_Read_Helper_Commit</a>( board_id, object_size, csb, commit_ready, &amp;commit_valid );
326: 		<a href="SPI_Status_Write_FIFO_Status@int@BOOL__@BOOL__@size_t__.html" target="topic">SPI_Status_Write_FIFO_Status</a>( board_id, &amp;tx_full, &amp;tx_empty, &amp;tx_bytes_available );
327: 	} <strong><span style="color: #008000;">while</span></strong> ( <strong><span style="color: #008000;">false</span></strong> == tx_empty );
328: 
329: <strong><span style="color: #008000;">#if</span></strong> defined( SPI_PRINT_DEBUG )
330: printf( &quot;  SPI_Data_Write_Read: Post Read Begin\n&quot; );
331: <strong><span style="color: #008000;">#endif</span></strong>
332: 
333: 	
334: 	<strong><span style="color: #008000;">while</span></strong> ( index_rx != index_tx )
335: 	{ 
336: 		error_code = SUCCESS;
337: 		<strong><span style="color: #008000;">if</span></strong> ( dataset-&gt;quit_application ) error_code = -EC_APP_TERMINATE_CTRLC;
338: 		<strong><span style="color: #008000;">if</span></strong> ( <a href="Character_Get@int__.html" target="topic">Character_Get</a>( NULL )     ) error_code = -EC_APP_TERMINATE;
339: 		<strong><span style="color: #008000;">if</span></strong> ( SUCCESS != error_code     )
340: 		{
341: 			printf( &quot;SPI_Data_Write_Read status ending receive loop\n&quot; );
342: 			<strong><span style="color: #008000;">goto</span></strong> SPI_Data_Write_Read_Error_Exit;
343: 		}
344: 		<a href="SPI_Data_Write_Read_Helper_Read@int@size_t@size_t@BOOL@size_t__@void__.html" target="topic">SPI_Data_Write_Read_Helper_Read</a>( board_id, object_size, tx_object_count, active_rx, &amp;index_rx, rx_buffer );
345: 	}
346: 	<strong><span style="color: #008000;">return</span></strong> SUCCESS;
347: 
348: SPI_Data_Write_Read_Error_Exit:
349: 
350: 
351: <strong><span style="color: #008000;">#if</span></strong> defined( SPI_PRINT_XFR_DEBUG )
352: 	printf( &quot;SPI_Data_Write_Read:\n&quot; );
353: 	<strong><span style="color: #008000;">#if</span></strong> defined( __MSDOS__ )
354: 	printf( &quot;  object_size       = %d\n&quot;, object_size );
355: 	printf( &quot;  tx_object_count   = %d\n&quot;, tx_object_count );
356: 	printf( &quot;  rx_object_count   = %d\n&quot;, rx_object_count );
357: 	printf( &quot;  index_tx          = %d\n&quot;, index_tx );
358: 	printf( &quot;  index_rx          = %d\n&quot;, index_rx );
359: 	printf( &quot;  tx_buffer         = %p\n&quot;, tx_buffer );
360: 	printf( &quot;  rx_buffer         = %p\n&quot;, rx_buffer );
361: 	<strong><span style="color: #008000;">#else</span></strong>
362: 	printf( &quot;  object_size       = %lu\n&quot;, object_size );
363: 	printf( &quot;  tx_object_count   = %lu\n&quot;, tx_object_count );
364: 	printf( &quot;  rx_object_count   = %lu\n&quot;, rx_object_count );
365: 	printf( &quot;  index_tx          = %lu\n&quot;, index_tx );
366: 	printf( &quot;  index_rx          = %lu\n&quot;, index_rx );
367: 	printf( &quot;  tx_buffer         = %p\n&quot;, tx_buffer );
368: 	printf( &quot;  rx_buffer         = %p\n&quot;, rx_buffer );
369: 	<strong><span style="color: #008000;">#endif</span></strong>
370: 	printf( &quot;  active_tx         = %s\n&quot;, active_tx ? &quot;true&quot; : &quot;false&quot; );
371: 	printf( &quot;  active_rx         = %s\n&quot;, active_rx ? &quot;true&quot; : &quot;false&quot; );
372: 
373: 	printf( &quot;  global_internal_tx_byte_count = %u\n&quot;, global_internal_tx_byte_count );
374: 	printf( &quot;  global_internal_rx_byte_count = %u\n&quot;, global_internal_rx_byte_count );
375: <strong><span style="color: #008000;">#endif</span></strong>
376: 
377: 
378: <strong><span style="color: #008000;">#define</span></strong> FUNCTION_NAME__  &quot;SPI_Data_Write_Read&quot;
379: <strong><span style="color: #008000;">#if</span></strong> ( <a href="IO_TRACE_USE_SPI_LOGGING.html" target="topic">IO_TRACE_USE_SPI_LOGGING</a> == 1 )
380: 	<a href="IO_Trace_Log_Function@char__@size_t@enum_IO_TRACE_ENUM@int@int.html" target="topic">IO_Trace_Log_Function</a>( FUNCTION_NAME__, __LINE__, IO_TRACE_SPI, board_id, error_code );
381: <strong><span style="color: #008000;">#endif</span></strong>
382: <strong><span style="color: #008000;">#undef</span></strong> FUNCTION_NAME__
383: 
384: 	<strong><span style="color: #008000;">return</span></strong> error_code;
385: }
</pre></div></div>
</div>
</div>
</div>
<a name="47726F7570"></a><div class="Element14">
<a onclick="toggleVisibilityStored(&#39;47726F7570&#39;);" class="a_Element14"><img src="btn_collapse_large.gif" border="0" alt="" title="" id="img47726F7570" />Group</a></div>
<div id="div47726F7570">
<div class="Element11">
<div class="Element10">
<p class="Element10">
<a href="!!FUNCTIONS.html" target="topic">Functions</a></p></div>
</div>
</div>
<a name="4C696E6B73"></a><div class="Element14">
<a onclick="toggleVisibilityStored(&#39;4C696E6B73&#39;);" class="a_Element14"><img src="btn_collapse_large.gif" border="0" alt="" title="" id="img4C696E6B73" />Links</a></div>
<div id="div4C696E6B73">
<div class="Element11">
<div class="Element10">
<a href="idi_c.html" target="topic">idi.c</a>, <a href="!!FUNCTIONS.html" target="topic">Functions</a>, <a href="!!NAVID_SPI_Data_Write_Read@int@size_t@size_t@void__@size_t@void___ST(16)_SEC_Body_Source.html" target="topic">Body Source</a></div>
</div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
Copyright © 2015 by Apex Embedded Systems.  All rights reserved.   Updated on Tuesday, September 01, 2015.</div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.html" target="tocidx">Contents</a> | <a href="idx.html" target="tocidx">Index</a> | <a href="index.html" target="topic">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
What do you think about this topic? <a href="#" onclick="sendFeedback('customer.service@apexembeddedsytems.com', 'STX104 Documentation Feedback', 'Project: STD-Bus Test Software Reference Manual%0ATopic ID: SPI_Data_Write_Read@int@size_t@size_t@void *@size_t@void *%0ATitle: SPI_Data_Write_Read Function');"> Send feedback! </a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>